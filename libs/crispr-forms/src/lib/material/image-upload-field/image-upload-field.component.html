<crispr-field-container
  [config]="config"
  [group]="group">
  <mat-form-field floatLabel="always"
    [color]="config.color"
    appearance="outline"
    [crisprFileDropzone]="!(disabled$ | async) && !(config.disableOnUpload && isUploaded)"
    [formGroup]="group"
    (fileDrop)="filesChanged($event)">

    <input [formControlName]="config.controlName" matInput type="text"/>

    <input #captureImage (change)="filesChanged($event.target.files)" type="file" capture="user" accept="image/*">

    <input
      #fileInput
      type="file"
      accept="image/*"
      multiple="false"
      (change)="filesChanged($event.target.files)"/>
    <mat-label>{{config.label}}</mat-label>

    <div *ngIf="!(selectedFiles?.length > 0); else imageDisplay"  class="drop-info">
      <mat-icon class="drop-icon" inline="true">cloud_upload</mat-icon>
      <h2 class="mat-h2">{{config.dropZoneText}}</h2>
      or
      <div>

        <button
          mat-button
          type="button"
          color="accent"
          [disabled]="(disabled$ | async) || config.disableOnUpload && isUploaded"
          (click)="fileInput.click()"
          [attr.aria-label]="config.controlName">
          <mat-icon>
            file_present
          </mat-icon>
          {{config.selectButtonText}}
        </button>

        <button
          mat-button
          type="button"
          color="primary"
          [disabled]="(disabled$ | async) || config.disableOnUpload && isUploaded"
          (click)="captureImage.click()"
          [attr.aria-label]="config.controlName">
          <mat-icon>
            camera
          </mat-icon>
          CAPTURE
        </button>

      </div>
    </div>
    <ng-template #imageDisplay>
      <div class="image-container">
        <img [src]="_imageSource || ''" alt="">
        <!-- <svg [src]="imageSource || ''" alt=""></svg> -->
      </div>
    </ng-template>

  </mat-form-field>

  <div class="button-container" *ngIf="selectedFiles?.length > 0">

    <button
      mat-button
      (click)="resetFileInput()"
      type="button"
      [disabled]="(disabled$ | async) || (config.disableOnUpload && isUploaded)"
      aria-label="Remove Selected File(s)">
      {{config.clearFilesButtonText}}
      <mat-icon>delete</mat-icon>
    </button>

    <button
      *ngIf="!!config.uploadFiles"
      mat-raised-button
      type="button"
      color="accent"
      class="file-input-button"
      [disabled]="(disabled$ | async) || (config.disableOnUpload && isUploaded)"
      (click)="uploadFiles()"
      [attr.aria-label]="config.uploadButtonText">
      {{ config.uploadButtonText }}
    </button>

  </div>
</crispr-field-container>
